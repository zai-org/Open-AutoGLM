# Open-AutoGLM 项目概要设计文档

**项目名称**: Open-AutoGLM 电话自动化智能代理系统  
**版本**: v0.2.0  
**日期**: 2025-12-15  
**作者**: GitHub Copilot  

---

## 目录

1. [项目概述](#项目概述)
2. [系统目标](#系统目标)
3. [核心功能](#核心功能)
4. [系统架构概览](#系统架构概览)
5. [关键特性](#关键特性)
6. [技术栈](#技术栈)
7. [系统边界](#系统边界)

---

## 项目概述

### 1.1 项目简介

Open-AutoGLM 是一个基于视觉语言模型（Vision Language Model）的手机自动化智能代理系统。通过集成先进的 AI 模型和 Android 设备控制技术，实现对移动设备的自动化操作，可以完成用户指定的各类任务。

### 1.2 核心价值

- **智能化**: 利用 AI 模型理解用户意图
- **自动化**: 自动完成手机上的复杂操作
- **可扩展**: 支持多设备并发操作
- **可靠性**: 完善的错误处理和恢复机制
- **可观测**: 全面的日志和性能监控

### 1.3 应用场景

- 📱 APP 自动化测试
- 📲 移动应用操作自动化
- 🔍 用户界面自动化爬取
- 🤖 复杂任务自动执行
- 📊 移动端数据采集

---

## 系统目标

### 2.1 功能目标

| 目标 | 说明 |
|------|------|
| 🎯 任务理解 | 理解用户自然语言指令 |
| 🎯 视觉识别 | 识别手机屏幕内容和UI元素 |
| 🎯 动作执行 | 执行点击、滑动、输入等操作 |
| 🎯 状态追踪 | 追踪任务执行进度和设备状态 |
| 🎯 错误恢复 | 在失败时自动恢复或报告 |

### 2.2 非功能目标

| 指标 | 目标值 |
|------|--------|
| ⚡ 响应时间 | < 5秒/步骤 |
| 📈 成功率 | > 85% |
| 🔒 安全性 | 完整的输入验证和日志脱敏 |
| 📊 可维护性 | 完整的代码文档和类型注解 |
| 💾 资源占用 | < 500MB 内存 |

---

## 核心功能

### 3.1 功能模块概览

```
┌─────────────────────────────────────────────────────────┐
│         Open-AutoGLM 核心功能模块                      │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐             │
│  │ 用户界面 │  │ 任务解析 │  │ 模型推理 │             │
│  └──────────┘  └──────────┘  └──────────┘             │
│         │            │              │                   │
│         └────────────┴──────────────┘                   │
│                      │                                  │
│         ┌────────────┴────────────┐                     │
│         ▼                         ▼                     │
│    ┌────────────┐         ┌─────────────┐              │
│    │ 设备控制   │         │ 屏幕截图    │              │
│    │ (ADB)      │         │ (截图/识别) │              │
│    └────────────┘         └─────────────┘              │
│         │                         │                     │
│         └────────────┬────────────┘                     │
│                      ▼                                  │
│         ┌───────────────────────┐                       │
│         │  动作执行引擎         │                       │
│         │  (Tap/Swipe/Input)    │                       │
│         └───────────────────────┘                       │
│                      │                                  │
│         ┌────────────┴────────────┐                     │
│         ▼                         ▼                     │
│    ┌────────────┐         ┌──────────────┐              │
│    │ 日志系统   │         │ 性能监控     │              │
│    └────────────┘         └──────────────┘              │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 3.2 主要功能描述

| 功能 | 描述 | 关键模块 |
|------|------|---------|
| **屏幕截图** | 获取当前设备屏幕快照 | `adb/screenshot.py` |
| **APP识别** | 识别当前运行的应用 | `adb/device.py` |
| **视觉理解** | AI模型分析屏幕内容 | `model/client.py` |
| **动作生成** | 生成执行动作指令 | `actions/handler.py` |
| **动作执行** | 在设备上执行操作 | `adb/input.py` |
| **状态管理** | 管理代理执行状态 | `agent.py` |
| **错误处理** | 捕获和处理异常 | `utils/` |
| **日志记录** | 记录执行过程 | `utils/monitoring.py` |
| **性能监控** | 追踪性能指标 | `utils/monitoring.py` |

---

## 系统架构概览

### 4.1 分层架构

```
┌────────────────────────────────────────────────────┐
│              表现层 (CLI Interface)                 │
│  ┌──────────────────────────────────────────────┐  │
│  │         main.py - 命令行入口                  │  │
│  └──────────────────────────────────────────────┘  │
└────────────────┬─────────────────────────────────┘
                 │
┌────────────────▼─────────────────────────────────┐
│            业务逻辑层 (Agent Layer)               │
│  ┌──────────────────────────────────────────────┐  │
│  │  PhoneAgent - 核心代理编排                   │  │
│  │  ├─ 任务管理                                 │  │
│  │  ├─ 步骤执行                                 │  │
│  │  └─ 状态管理                                 │  │
│  └──────────────────────────────────────────────┘  │
└────────────────┬─────────────────────────────────┘
                 │
        ┌────────┴────────┐
        │                 │
┌───────▼──────┐  ┌──────▼──────┐
│ 模型交互层   │  │ 设备控制层  │
├──────────────┤  ├─────────────┤
│ ModelClient  │  │  ADBDevice  │
│ - API调用    │  │  - 截图    │
│ - 响应解析   │  │  - 输入    │
│ - 错误处理   │  │  - 设备管理 │
└───────┬──────┘  └──────┬──────┘
        │                 │
┌───────▼─────────────────▼─────┐
│      工具和支撑层             │
│  ┌──────────────────────────┐  │
│  │ 配置管理 | 日志系统      │  │
│  │ 缓存机制 | 性能监控      │  │
│  │ 输入验证 | 敏感数据过滤  │  │
│  │ 速率限制 | 通用工具      │  │
│  └──────────────────────────┘  │
└───────────────────────────────┘
        │
┌───────▼──────────────────────────┐
│      外部服务和设备               │
│  ┌──────────────────────────────┐ │
│  │ • 视觉语言模型 API           │ │
│  │ • Android 设备 (via ADB)      │ │
│  │ • 操作系统和文件系统         │ │
│  └──────────────────────────────┘ │
└────────────────────────────────────┘
```

### 4.2 模块组织

```
phone_agent/
├── __init__.py              # 包初始化和公共导出
├── agent.py                 # 核心代理类
│
├── model/
│   ├── __init__.py
│   └── client.py            # 模型API客户端
│
├── actions/
│   ├── __init__.py
│   └── handler.py           # 动作解析和执行
│
├── adb/
│   ├── __init__.py
│   ├── connection.py        # ADB连接管理
│   ├── device.py            # 设备操作
│   ├── screenshot.py        # 截图功能
│   └── input.py             # 输入操作
│
└── utils/
    ├── __init__.py
    ├── cache.py             # 缓存机制
    ├── config.py            # 配置管理
    ├── monitoring.py        # 日志和监控
    └── security.py          # 安全验证

examples/
├── basic_usage.py           # 基础用法
├── demo_thinking.py         # 演示思考过程
└── optimization_features.py # 优化特性演示

scripts/
├── deploy_windows.ps1       # Windows部署脚本
├── deploy_linux.sh          # Linux部署脚本
└── check_imports.py         # 导入检查脚本
```

---

## 关键特性

### 5.1 v0.2.0 优化版本特性

#### 🔧 代码质量
- ✅ **完整的类型注解** - 使用 Python 3.9+ 兼容的 Optional 类型
- ✅ **全面的日志系统** - 30+ 个日志点覆盖关键操作
- ✅ **自动参数验证** - ModelConfig/AgentConfig 配置验证
- ✅ **增强错误处理** - 详细的错误消息和异常捕获

#### ⚡ 性能优化
- ✅ **智能缓存机制** - SimpleCache + ScreenshotCache (TTL支持)
- ✅ **哈希对比** - MD5 哈希减少重复处理
- ✅ **性能监控** - 完整的操作计时和统计

#### 🔒 安全加固
- ✅ **输入验证** - SQL注入、XSS、路径遍历检测
- ✅ **敏感数据过滤** - 自动掩盖电话、邮箱、密钥
- ✅ **速率限制** - API调用频率控制
- ✅ **日志脱敏** - 敏感信息自动隐藏

#### 📊 可观测性
- ✅ **结构化日志** - 支持文件和控制台输出
- ✅ **性能指标** - 获取平均/最大/最小执行时间
- ✅ **配置管理** - JSON/YAML配置文件支持
- ✅ **调试工具** - 详细的调试和诊断功能

---

## 技术栈

### 6.1 核心技术

| 层级 | 技术 | 版本 | 用途 |
|------|------|------|------|
| 语言 | Python | 3.10+ | 主要编程语言 |
| 框架 | 无依赖 | - | 轻量级设计 |
| AI模型 | OpenAI兼容 API | 2.9.0+ | 视觉语言模型 |
| 设备控制 | Android Debug Bridge | 最新 | 手机控制 |
| 图像处理 | Pillow | 12.0.0+ | 屏幕截图处理 |

### 6.2 主要依赖

```
核心依赖:
├── openai>=2.9.0        # 模型API调用
├── Pillow>=12.0.0       # 图像处理
└── (隐式) platform-tools # ADB工具

开发工具:
├── pytest>=7.0.0        # 单元测试
├── black>=23.0.0        # 代码格式化
├── ruff>=0.1.0          # 代码检查
├── mypy>=1.0.0          # 类型检查
├── pyyaml>=6.0          # YAML配置
└── pre-commit>=4.5.0    # Git钩子
```

### 6.3 设计模式

| 模式 | 应用场景 | 示例 |
|------|---------|------|
| **工厂模式** | 配置加载 | ConfigLoader 类方法 |
| **策略模式** | 动作处理 | parse_action() 多级策略 |
| **观察者模式** | 性能监控 | PerformanceMonitor 回调 |
| **上下文管理器** | 资源管理 | MetricsCollector __enter__/__exit__ |
| **单例模式** | 全局实例 | get_performance_monitor() |

---

## 系统边界

### 7.1 系统范围

#### 包括 ✅
- 手机屏幕截图和分析
- AI 模型的调用和响应处理
- 设备操作的执行（点击、滑动、文本输入）
- 任务的编排和状态管理
- 错误处理和恢复机制
- 日志记录和性能监控
- 配置管理和参数验证
- 安全防护和数据保护

#### 不包括 ❌
- AI 模型的训练和微调
- 手机系统的修改和定制
- 应用的安装和卸载
- 网络通信的底层协议
- 用户界面的绘制（使用现有模型）

### 7.2 外部依赖

```
┌─────────────────────────────────────┐
│        外部系统和服务               │
├─────────────────────────────────────┤
│                                     │
│  ┌───────────────────────────────┐  │
│  │   视觉语言模型 API             │  │
│  │   (OpenAI兼容或自部署)         │  │
│  │   - 请求: 截图 + 指令         │  │
│  │   - 响应: 动作指令             │  │
│  └───────────────────────────────┘  │
│                                     │
│  ┌───────────────────────────────┐  │
│  │   Android 设备                  │  │
│  │   (通过ADB连接)                 │  │
│  │   - 截图接收                   │  │
│  │   - 命令执行                    │  │
│  └───────────────────────────────┘  │
│                                     │
└─────────────────────────────────────┘
         ▲
         │ 通信协议
         │
    ┌────┴────┐
    │ 网络连接 │
    └────┬────┘
         │
    ┌────▼────────┐
    │ Open-AutoGLM│
    └─────────────┘
```

### 7.3 约束条件

| 约束 | 说明 |
|------|------|
| 🔌 **硬件** | 需要 Android 设备或模拟器，ADB 可连接 |
| 🌐 **网络** | 模型 API 需要网络连接，建议 50Mbps+ |
| 💾 **存储** | 最小 100MB 磁盘空间，日志会占用额外空间 |
| 🔑 **认证** | 需要有效的 API 密钥（或本地部署模型） |
| ⏱️ **延迟** | 单步操作 1-5 秒，网络延迟会影响总体时间 |

---

## 下一步

1. **详细设计** → 查看 `02_系统详细设计文档.md`
2. **API文档** → 查看 `03_API设计文档.md`
3. **部署指南** → 查看 `scripts/README_DEPLOY.md`

